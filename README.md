# CommonHall

**Enterprise Intranet & Employee Communication Platform**

A modern, full-featured internal communications platform built for enterprises that need to connect, engage, and inform their workforce across multiple channels.

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![.NET](https://img.shields.io/badge/.NET-10.0-purple.svg)](https://dotnet.microsoft.com/)
[![Next.js](https://img.shields.io/badge/Next.js-14-black.svg)](https://nextjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.3-blue.svg)](https://www.typescriptlang.org/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue.svg)](https://www.postgresql.org/)

---

## Why CommonHall?

Modern enterprises struggle with fragmented internal communications. Employees miss important updates, can't find the information they need, and feel disconnected from company culture. CommonHall solves this by providing:

- **Unified Content Hub** - One place for news, policies, resources, and company information
- **Multi-Channel Delivery** - Reach employees via web, email, push notifications, SMS, and digital signage
- **Intelligent Search** - AI-powered search that understands natural language questions
- **Personalized Experience** - Content targeted by department, location, role, or custom attributes
- **Automated Journeys** - Onboarding workflows, milestone communications, and scheduled content delivery
- **Engagement Tools** - Communities, messaging, surveys, and social features that build culture
- **Actionable Analytics** - Understand what content resonates and how employees engage

Built with enterprise-grade security, scalability, and the flexibility to adapt to any organization's needs.

---

## Screenshots

> Screenshots coming soon. The platform includes:
> - Modern intranet homepage with personalized content feeds
> - Rich content editor with AI writing assistance
> - Admin Studio for content and user management
> - Analytics dashboards with engagement metrics
> - Mobile-responsive design for all screen sizes

---

## Features

<details>
<summary><strong>Content Management System</strong></summary>

### Publishing & Workflow
- Rich text editor with media embedding (images, videos, documents)
- Draft, publish, schedule, and archive workflow
- Content versioning with full history and restore
- Scheduled publishing and automatic expiration
- Multi-language content with translation support
- SEO metadata and custom URL slugs

### Content Types
- **News Articles** - Company announcements, updates, and stories
- **Pages** - Static content with flexible widget-based layouts
- **Spaces** - Organized content areas by team, department, or topic
- **Files** - Document library with search and categorization

### Organization
- Hierarchical page structures
- Categories and tags for discoverability
- Featured and pinned content
- Related content suggestions (AI-powered)
- Full-text search across all content

</details>

<details>
<summary><strong>Widget System</strong></summary>

Build flexible page layouts with drag-and-drop widgets:

| Widget | Description |
|--------|-------------|
| Rich Text | Formatted content with inline media |
| Image | Single images with captions and links |
| Video | Embedded or uploaded video content |
| Document | File previews with download links |
| News Feed | Dynamic news article listings |
| People | Employee directory and org chart |
| Calendar | Upcoming events and dates |
| Quick Links | Curated link collections |
| Embed | External content via iframe |
| Social Feed | Community posts and activity |
| Form | Embedded surveys and forms |
| Accordion | Collapsible FAQ sections |
| Hero | Full-width banners and CTAs |

</details>

<details>
<summary><strong>Multi-Channel Distribution</strong></summary>

Reach every employee through their preferred channel:

- **Web Portal** - Responsive intranet accessible from any device
- **Email Newsletters** - WYSIWYG composer with templates and scheduling
- **Push Notifications** - Browser-based push for urgent updates
- **SMS** - Text message delivery for critical communications
- **Digital Signage** - Dedicated API for office displays

### Email Features
- Visual email builder with reusable templates
- Personalization tokens (name, department, etc.)
- Scheduled sending with timezone support
- Open and click tracking analytics
- A/B testing for subject lines

</details>

<details>
<summary><strong>Personalization & Targeting</strong></summary>

Deliver relevant content to every employee:

### Audience Segments
- Create segments based on any user attribute
- Complex rules with AND/OR logic
- Department, location, role targeting
- Custom attribute support for unique needs

### Content Targeting
- Target articles to specific audiences
- Personalized homepage feeds
- Notification preferences per user
- Content recommendations based on behavior

### A/B Testing
- Test content variations
- Measure engagement differences
- Data-driven content optimization

</details>

<details>
<summary><strong>Employee Journeys</strong></summary>

Automated, multi-step communication workflows:

### Journey Builder
- Visual workflow editor
- Trigger-based journey activation
- Multiple step types and conditions

### Step Types
| Type | Description |
|------|-------------|
| Delay | Wait for specified duration |
| Condition | Branch based on user attributes |
| Send Email | Deliver templated emails |
| Assign Task | Create actionable items |
| Deliver Content | Surface specific articles |

### Use Cases
- New employee onboarding
- Anniversary milestones
- Policy acknowledgments
- Training sequences
- Offboarding checklists

</details>

<details>
<summary><strong>Search & Discovery</strong></summary>

Find anything, instantly:

- **Full-Text Search** - Search across all content types
- **Natural Language** - Ask questions in plain English
- **Faceted Filtering** - Filter by type, date, author, tags
- **Autocomplete** - Suggestions as you type
- **File Content** - Search inside documents
- **People Search** - Find colleagues by name, skill, department

### AI-Powered Search
- Semantic understanding of queries
- Question answering from content
- Related content suggestions
- Search intent detection

</details>

<details>
<summary><strong>Employee Directory</strong></summary>

Connect people across the organization:

- **Rich Profiles** - Photos, contact info, skills, bio
- **Organization Chart** - Visual hierarchy navigation
- **Department Views** - Browse by team structure
- **Skills Search** - Find expertise across the company
- **Direct Integration** - Click to email, call, or message

</details>

<details>
<summary><strong>Social & Engagement</strong></summary>

Build community and culture:

### Interaction Features
- Comments on all content types
- Reactions (like, celebrate, etc.)
- @mentions with notifications
- Share content internally

### Communities
- Public and private group spaces
- Community posts and discussions
- Membership management
- Community-specific content

### Messaging
- Direct messages (1:1)
- Group conversations
- Real-time chat with SignalR
- Read receipts and typing indicators
- Message history and search

### Notifications
- In-app notification center
- Email notification digests
- Push notification support
- Configurable preferences

</details>

<details>
<summary><strong>Surveys & Forms</strong></summary>

Gather feedback and collect data:

### Survey Builder
- Drag-and-drop question builder
- Multiple question types
- Conditional logic and branching
- Anonymous response option

### Question Types
- Short text and long text
- Single and multiple choice
- Rating scales and matrices
- File upload
- Date and time pickers

### Distribution
- Email invitations
- Embedded in pages
- Targeted by audience
- Scheduled availability

### Analytics
- Real-time response tracking
- Visual charts and graphs
- Cross-tabulation analysis
- Export to CSV/Excel

### Forms
- Data collection forms
- Workflow integration
- Submission management
- Webhook triggers

</details>

<details>
<summary><strong>AI Features</strong></summary>

Powered by Anthropic Claude:

### Writing Assistant
- Generate content from prompts
- Rewrite and improve existing text
- Adjust tone (professional, casual, etc.)
- Grammar and spelling suggestions
- Content summarization
- Multi-language translation

### Intelligent Search
- Natural language queries
- Semantic understanding
- Question answering
- Context-aware results

### Content Health
- Readability scoring
- Accessibility analysis
- Freshness tracking
- Improvement suggestions
- Broken link detection

</details>

<details>
<summary><strong>Analytics & Measurement</strong></summary>

Data-driven communications:

### Engagement Metrics
- Page views and unique visitors
- Time on page and scroll depth
- Content engagement rates
- User activity trends

### Content Analytics
- Top performing content
- Engagement by content type
- Author performance
- Publication trends

### Audience Insights
- Department engagement
- Location-based metrics
- Role-based analysis
- Custom segment tracking

### Email Analytics
- Open and click rates
- Device and client breakdown
- Link performance
- Delivery metrics

### Reporting
- Custom date ranges
- Export capabilities
- Scheduled reports
- Dashboard widgets

</details>

<details>
<summary><strong>Admin Studio</strong></summary>

Complete administration interface:

### Content Management
- News article management
- Page builder and management
- Space configuration
- File library
- Comment moderation

### User Management
- User directory
- Role assignment
- Permission management
- Bulk operations

### Communications
- Newsletter management
- Journey configuration
- Notification settings

### Feedback
- Survey management
- Form builder
- Response analysis

### Settings
- System configuration
- Branding options
- Integration settings
- Audit logging

</details>

---

## Tech Stack

| Layer | Technology | Purpose |
|-------|------------|---------|
| **Frontend** | Next.js 14 | React framework with App Router |
| | TypeScript 5.3 | Type-safe JavaScript |
| | Tailwind CSS | Utility-first styling |
| | shadcn/ui | Component library |
| | TanStack Query | Data fetching and caching |
| | Zustand | Client state management |
| | TipTap | Rich text editor |
| **Backend** | .NET 10 | Web API framework |
| | C# 14 | Programming language |
| | Entity Framework Core 10 | ORM and data access |
| | MediatR | CQRS and mediator pattern |
| | FluentValidation | Request validation |
| | SignalR | Real-time WebSocket communication |
| **Database** | PostgreSQL 16 | Primary data store |
| | Redis 7 | Caching and sessions |
| | Elasticsearch 8 | Full-text search |
| **AI** | Anthropic Claude | Content generation and search |
| **Infrastructure** | Docker | Containerization |
| | Nginx | Reverse proxy |
| | SendGrid | Email delivery |
| | Twilio | SMS delivery |

---

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         Clients                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────────────┐ │
│  │   Web    │  │  Mobile  │  │  Email   │  │ Digital Signage  │ │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────────┬─────────┘ │
└───────┼─────────────┼─────────────┼─────────────────┼───────────┘
        │             │             │                 │
        └─────────────┴──────┬──────┴─────────────────┘
                             │
                      ┌──────▼──────┐
                      │    Nginx    │
                      │   (Proxy)   │
                      └──────┬──────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
 ┌──────▼──────┐      ┌──────▼──────┐     ┌──────▼──────┐
 │   Next.js   │      │   .NET API  │     │   SignalR   │
 │  Frontend   │◄────►│   Backend   │◄───►│  Real-time  │
 └─────────────┘      └──────┬──────┘     └─────────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
 ┌──────▼──────┐      ┌──────▼──────┐     ┌──────▼──────┐
 │ PostgreSQL  │      │    Redis    │     │Elasticsearch│
 │  Database   │      │    Cache    │     │   Search    │
 └─────────────┘      └─────────────┘     └─────────────┘
```

### Backend Architecture (Clean Architecture)

```
┌─────────────────────────────────────────────────────────────┐
│                      CommonHall.Api                          │
│  Controllers, Middleware, DI Configuration, Program.cs      │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                  CommonHall.Application                      │
│  MediatR Handlers, Commands, Queries, DTOs, Validators      │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                  CommonHall.Infrastructure                   │
│  EF Core, Repositories, External Services, Migrations       │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                    CommonHall.Domain                         │
│  Entities, Value Objects, Enums, Domain Events              │
└─────────────────────────────────────────────────────────────┘
```

### Frontend Architecture (Feature-Based)

```
src/
├── app/                    # Next.js App Router pages
│   ├── (main)/            # Public intranet routes
│   └── (studio)/          # Admin studio routes
├── components/            # Shared UI components
│   ├── ui/               # shadcn/ui primitives
│   └── layout/           # Layout components
├── features/             # Feature modules
│   ├── news/            # News feature
│   │   ├── api/         # API hooks
│   │   ├── components/  # Feature components
│   │   ├── hooks/       # Custom hooks
│   │   └── types/       # TypeScript types
│   ├── pages/           # Pages feature
│   ├── search/          # Search feature
│   └── ...              # Other features
├── lib/                  # Utilities and configs
└── styles/              # Global styles
```

---

## Getting Started

### Prerequisites

- **Node.js** 20.x or later
- **pnpm** 8.x or later
- **.NET SDK** 10.0 or later
- **Docker** and **Docker Compose**

### Quick Start

```bash
# Clone the repository
git clone https://github.com/your-org/commonhall.git
cd commonhall

# Install dependencies
make install

# Start infrastructure (PostgreSQL, Redis, Elasticsearch)
make dev-infra

# Run database migrations
make migrate

# Seed initial data (optional)
make seed

# Start the API (in one terminal)
make dev-api

# Start the frontend (in another terminal)
make dev-web
```

The application will be available at:
- **Frontend**: http://localhost:3000
- **API**: http://localhost:5000
- **API Docs**: http://localhost:5000/swagger

### Default Credentials

After seeding, you can log in with:
- **Admin**: admin@commonhall.local / Admin123!
- **User**: user@commonhall.local / User123!

---

## Project Structure

```
commonhall/
├── apps/
│   ├── api/                          # .NET Backend
│   │   ├── CommonHall.Api/           # API layer
│   │   │   ├── Controllers/          # HTTP endpoints
│   │   │   ├── Hubs/                 # SignalR hubs
│   │   │   ├── Middleware/           # Custom middleware
│   │   │   └── Extensions/           # DI extensions
│   │   ├── CommonHall.Application/   # Application layer
│   │   │   ├── Features/             # CQRS handlers by feature
│   │   │   ├── Interfaces/           # Service contracts
│   │   │   └── Common/               # Shared application code
│   │   ├── CommonHall.Domain/        # Domain layer
│   │   │   ├── Entities/             # Domain entities
│   │   │   ├── Enums/                # Enumerations
│   │   │   └── ValueObjects/         # Value objects
│   │   └── CommonHall.Infrastructure/# Infrastructure layer
│   │       ├── Persistence/          # EF Core, repositories
│   │       ├── Services/             # External service implementations
│   │       └── Migrations/           # Database migrations
│   │
│   └── web/                          # Next.js Frontend
│       ├── src/
│       │   ├── app/                  # App Router pages
│       │   ├── components/           # Shared components
│       │   ├── features/             # Feature modules
│       │   ├── lib/                  # Utilities
│       │   └── styles/               # Global styles
│       └── public/                   # Static assets
│
├── packages/
│   ├── shared-types/                 # Shared TypeScript types
│   └── ui/                           # Shared React components
│
├── infrastructure/
│   ├── docker/                       # Docker configurations
│   └── nginx/                        # Nginx configurations
│
├── docs/                             # Documentation
├── Makefile                          # Development commands
├── docker-compose.yml                # Development services
└── CLAUDE.md                         # AI assistant context
```

---

## API Documentation

The API follows RESTful conventions with consistent patterns:

### Base URL
```
https://api.commonhall.local/api/v1
```

### Authentication
```bash
# Login
POST /api/v1/auth/login
{
  "email": "user@example.com",
  "password": "password123"
}

# Response includes JWT token
{
  "data": {
    "accessToken": "eyJ...",
    "refreshToken": "abc123...",
    "expiresAt": "2024-01-01T12:00:00Z"
  }
}

# Use token in subsequent requests
Authorization: Bearer eyJ...
```

### Response Format

All endpoints return consistent envelope responses:

```json
{
  "data": { },
  "errors": [],
  "meta": {
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### Pagination

Cursor-based pagination for list endpoints:

```json
{
  "data": {
    "items": [...],
    "nextCursor": "abc123",
    "hasMore": true
  }
}
```

### Key Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| **Authentication** |||
| POST | /auth/login | Authenticate user |
| POST | /auth/refresh | Refresh access token |
| POST | /auth/logout | Invalidate tokens |
| **News** |||
| GET | /news | List news articles |
| GET | /news/{slug} | Get article by slug |
| POST | /news | Create article |
| PUT | /news/{id} | Update article |
| DELETE | /news/{id} | Delete article |
| **Pages** |||
| GET | /pages | List pages |
| GET | /pages/{slug} | Get page by slug |
| POST | /pages | Create page |
| PUT | /pages/{id} | Update page |
| **Spaces** |||
| GET | /spaces | List spaces |
| GET | /spaces/{slug} | Get space with content |
| **Search** |||
| GET | /search | Full-text search |
| GET | /search/suggestions | Autocomplete |
| POST | /search/ai | AI-powered search |
| **Users** |||
| GET | /users | List users |
| GET | /users/{id} | Get user profile |
| GET | /users/me | Current user |

Full API documentation available at `/swagger` when running the API.

---

## Development

### Available Commands

```bash
# Infrastructure
make dev-infra          # Start PostgreSQL, Redis, Elasticsearch
make dev-infra-down     # Stop infrastructure
make dev-infra-logs     # View infrastructure logs

# Development servers
make dev-api            # Run API with hot reload
make dev-web            # Run frontend with hot reload

# Database
make migrate            # Apply pending migrations
make migrate-add name=X # Create new migration
make seed               # Seed development data

# Build
make build              # Build all projects
make build-api          # Build API only
make build-web          # Build frontend only

# Test
make test               # Run all tests
make test-api           # Run backend tests
make test-web           # Run frontend tests

# Code quality
make lint               # Check code style
make lint-fix           # Fix code style issues

# Cleanup
make clean              # Remove build artifacts
make clean-volumes      # Remove Docker volumes (WARNING: destroys data)
```

### Environment Variables

Copy `.env.example` to `.env` and configure:

```bash
# Database
DATABASE_URL=Host=localhost;Database=commonhall;Username=postgres;Password=postgres

# Redis
REDIS_URL=localhost:6379

# Elasticsearch
ELASTICSEARCH_URL=http://localhost:9200

# JWT
JWT_SECRET=your-secret-key-min-32-characters
JWT_ISSUER=commonhall
JWT_AUDIENCE=commonhall

# AI
ANTHROPIC_API_KEY=sk-ant-...

# Email (SendGrid)
SENDGRID_API_KEY=SG....

# SMS (Twilio)
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...
TWILIO_PHONE_NUMBER=+1...
```

### Adding a New Feature

1. **Backend**: Create feature folder in `CommonHall.Application/Features/`
   - Add command/query records
   - Add handlers with MediatR
   - Add validators with FluentValidation
   - Add controller endpoints

2. **Frontend**: Create feature folder in `src/features/`
   - Add `api/` folder with TanStack Query hooks
   - Add `components/` for UI components
   - Add `types/` for TypeScript interfaces
   - Add pages in `src/app/`

### Code Conventions

**Backend (C#/.NET)**
- PascalCase for public members
- _camelCase for private fields
- Async suffix for async methods
- All entities inherit from BaseEntity
- Use records for DTOs and CQRS

**Frontend (TypeScript/React)**
- camelCase for variables/functions
- PascalCase for components/types
- Interface for object shapes
- Type for unions/intersections
- No `any` - use `unknown`

---

## Deployment

### Production Build

```bash
# Build production images
docker build -t commonhall-api:latest -f apps/api/Dockerfile .
docker build -t commonhall-web:latest -f apps/web/Dockerfile .

# Or use docker-compose
docker-compose -f docker-compose.prod.yml build
```

### Docker Compose (Production)

```bash
# Start all services
docker-compose -f docker-compose.prod.yml up -d

# View logs
docker-compose -f docker-compose.prod.yml logs -f

# Stop services
docker-compose -f docker-compose.prod.yml down
```

### Environment Configuration

Production environment variables:

```bash
# Required
DATABASE_URL=Host=postgres;Database=commonhall;Username=...;Password=...
REDIS_URL=redis:6379
ELASTICSEARCH_URL=http://elasticsearch:9200
JWT_SECRET=<strong-random-secret>
ANTHROPIC_API_KEY=sk-ant-...

# Optional integrations
SENDGRID_API_KEY=SG....
TWILIO_ACCOUNT_SID=AC...
AZURE_STORAGE_CONNECTION_STRING=...
```

### Health Checks

The API exposes health check endpoints:

```bash
# Basic health check
GET /health

# Detailed health check (includes dependencies)
GET /health/ready
```

### Scaling Considerations

- **API**: Stateless, horizontally scalable behind load balancer
- **Frontend**: Static export or container scaling
- **PostgreSQL**: Primary-replica for read scaling
- **Redis**: Cluster mode for high availability
- **Elasticsearch**: Multi-node cluster for search scaling

---

## Roadmap

### Current Release
- Core content management
- Multi-channel distribution
- AI-powered search and writing
- Employee journeys
- Surveys and forms
- Analytics dashboard

### Upcoming
- [ ] Mobile native apps (React Native)
- [ ] Microsoft 365 integration
- [ ] Advanced workflow automation
- [ ] Custom branding themes
- [ ] SSO with SAML/OIDC
- [ ] Advanced permissions model
- [ ] Content approval workflows
- [ ] API webhooks
- [ ] Third-party integrations marketplace

### Future Considerations
- Multi-tenant architecture
- On-premises deployment option
- Advanced compliance features
- Custom widget development SDK

---

## Contributing

We welcome contributions! Please see our contributing guidelines:

1. **Fork** the repository
2. **Create** a feature branch (`git checkout -b feature/amazing-feature`)
3. **Commit** your changes (`git commit -m 'Add amazing feature'`)
4. **Push** to the branch (`git push origin feature/amazing-feature`)
5. **Open** a Pull Request

### Development Guidelines

- Follow existing code conventions
- Write tests for new features
- Update documentation as needed
- Keep PRs focused and atomic

### Reporting Issues

Found a bug or have a feature request? [Open an issue](https://github.com/your-org/commonhall/issues) with:
- Clear description
- Steps to reproduce (for bugs)
- Expected vs actual behavior
- Screenshots if applicable

---

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## Acknowledgements

Built with these excellent open-source projects:

- [Next.js](https://nextjs.org/) - React framework
- [.NET](https://dotnet.microsoft.com/) - Backend framework
- [shadcn/ui](https://ui.shadcn.com/) - UI components
- [TanStack Query](https://tanstack.com/query) - Data fetching
- [TipTap](https://tiptap.dev/) - Rich text editor
- [MediatR](https://github.com/jbogard/MediatR) - Mediator pattern
- [Entity Framework Core](https://docs.microsoft.com/ef/core/) - ORM
- [PostgreSQL](https://www.postgresql.org/) - Database
- [Redis](https://redis.io/) - Caching
- [Elasticsearch](https://www.elastic.co/) - Search engine
- [Anthropic Claude](https://www.anthropic.com/) - AI capabilities

---

<p align="center">
  Made with care for internal communicators everywhere
</p>
